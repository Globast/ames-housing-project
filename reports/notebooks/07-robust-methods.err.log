Traceback (most recent call last):
  File "/home/codespace/.local/lib/python3.12/site-packages/jupyter_core/utils/__init__.py", line 154, in wrapped
    asyncio.get_running_loop()
RuntimeError: no running event loop

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/codespace/.python/current/lib/python3.12/site-packages/jupyter_cache/executors/utils.py", line 58, in single_nb_execution
    executenb(
  File "/home/codespace/.local/lib/python3.12/site-packages/nbclient/client.py", line 1319, in execute
    return NotebookClient(nb=nb, resources=resources, km=km, **kwargs).execute()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/codespace/.local/lib/python3.12/site-packages/jupyter_core/utils/__init__.py", line 158, in wrapped
    return loop.run_until_complete(inner)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/codespace/.python/current/lib/python3.12/asyncio/base_events.py", line 684, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/home/codespace/.local/lib/python3.12/site-packages/nbclient/client.py", line 709, in async_execute
    await self.async_execute_cell(
  File "/home/codespace/.local/lib/python3.12/site-packages/nbclient/client.py", line 1062, in async_execute_cell
    await self._check_raise_for_error(cell, cell_index, exec_reply)
  File "/home/codespace/.local/lib/python3.12/site-packages/nbclient/client.py", line 918, in _check_raise_for_error
    raise CellExecutionError.from_cell_and_msg(cell, exec_reply_content)
nbclient.exceptions.CellExecutionError: An error occurred while executing the following cell:
------------------
import pandas as pd
import numpy as np

# 0) Carga bootstrap_df si no existe (usando la ruta canÃ³nica BOOT_CSV_PATH)
try:
    bootstrap_df  # noqa: F821
except NameError:
    try:
        bootstrap_df = pd.read_csv(BOOT_CSV_PATH)
        print("Cargado bootstrap_df desde:", BOOT_CSV_PATH)
    except Exception as e:
        print("Aviso: no se pudo cargar bootstrap_df automÃ¡ticamente:", e)

# 1) OLS (base)
coef_ols = modelo_base.params                    # pd.Series con Ã­ndice = nombres de coeficientes
se_ols   = modelo_base.bse                       # pd.Series
ci_ols   = modelo_base.conf_int()                # pd.DataFrame [lower, upper]
ic_ols_width = ci_ols.iloc[:, 1] - ci_ols.iloc[:, 0]
if not isinstance(ic_ols_width, pd.Series):
    ic_ols_width = pd.Series(ic_ols_width, index=coef_ols.index)

# 2) HC3 (robusta)
# En algunos entornos, bse/conf_int del objeto robusto devuelven arrays â†’ conviÃ©rtelos y ALÃNEALOS
se_hc3_raw = getattr(resultados_HC3, "bse", None)
if isinstance(se_hc3_raw, pd.Series):
    se_hc3 = se_hc3_raw
else:
    se_hc3 = pd.Series(np.asarray(se_hc3_raw), index=coef_ols.index)

ci_hc3_raw = resultados_HC3.conf_int()
if isinstance(ci_hc3_raw, pd.DataFrame):
    ic_hc3_width = ci_hc3_raw.iloc[:, 1] - ci_hc3_raw.iloc[:, 0]
    if not isinstance(ic_hc3_width, pd.Series):
        ic_hc3_width = pd.Series(ic_hc3_width, index=coef_ols.index)
else:
    arr = np.asarray(ci_hc3_raw)  # shape (p,2)
    ic_hc3_width = pd.Series(arr[:, 1] - arr[:, 0], index=coef_ols.index)

# 3) Bootstrap
# Normaliza bootstrap_df para que su Ã­ndice sean los nombres de coeficientes y haya columnas esperadas
if isinstance(bootstrap_df, pd.DataFrame):
    # Intenta detectar columna de nombres
    name_cols = [c for c in bootstrap_df.columns if c.lower() in ("term", "variable", "coef_name", "feature")]
    if name_cols:
        bootstrap_df = bootstrap_df.set_index(name_cols[0])
    elif len(bootstrap_df) == len(coef_ols) and bootstrap_df.index.dtype == "int64":
        # Si el tamaÃ±o coincide y el Ã­ndice es numÃ©rico, usa el Ã­ndice de coef_ols
        bootstrap_df.index = coef_ols.index

    # Columnas esperadas (ajusta aquÃ­ si en tu CSV tienen otros nombres)
    col_mean = "Coef_mean"
    col_se   = "SE_bootstrap"
    col_l    = "IC_2.5%"
    col_u    = "IC_97.5%"

    # Series desde bootstrap con reindex para alinear
    coef_boot_mean = bootstrap_df[col_mean].reindex(coef_ols.index) if col_mean in bootstrap_df.columns else pd.Series(dtype=float, index=coef_ols.index)
    se_boot        = bootstrap_df[col_se].reindex(coef_ols.index)   if col_se   in bootstrap_df.columns else pd.Series(dtype=float, index=coef_ols.index)

    if {col_l, col_u}.issubset(bootstrap_df.columns):
        ic_boot_width = (bootstrap_df[col_u] - bootstrap_df[col_l]).reindex(coef_ols.index)
    else:
        ic_boot_width = pd.Series(dtype=float, index=coef_ols.index)
else:
    # Fallback si bootstrap_df no es DataFrame
    coef_boot_mean = pd.Series(dtype=float, index=coef_ols.index)
    se_boot        = pd.Series(dtype=float, index=coef_ols.index)
    ic_boot_width  = pd.Series(dtype=float, index=coef_ols.index)

# 4) DataFrame comparativo (todo alineado por Ã­ndice)
comparative_df = pd.DataFrame({
    "Coef_OLS": coef_ols,
    "Coef_Bootstrap": coef_boot_mean,
    "SE_OLS": se_ols,
    "SE_HC3": se_hc3.reindex(coef_ols.index) if isinstance(se_hc3, pd.Series) else pd.Series(se_hc3, index=coef_ols.index),
    "SE_Bootstrap": se_boot,
    "IC_width_OLS": ic_ols_width.reindex(coef_ols.index) if isinstance(ic_ols_width, pd.Series) else pd.Series(ic_ols_width, index=coef_ols.index),
    "IC_width_HC3": ic_hc3_width.reindex(coef_ols.index) if isinstance(ic_hc3_width, pd.Series) else pd.Series(ic_hc3_width, index=coef_ols.index),
    "IC_width_Bootstrap": ic_boot_width,
})

# 5) Tablas finales
coef_df = comparative_df[["Coef_OLS", "Coef_Bootstrap"]]
se_df   = comparative_df[["SE_OLS", "SE_HC3", "SE_Bootstrap"]]
ic_df   = comparative_df[["IC_width_OLS", "IC_width_HC3", "IC_width_Bootstrap"]]

# Vista
coef_df
------------------

----- stdout -----
Aviso: no se pudo cargar bootstrap_df automÃ¡ticamente: name 'BOOT_CSV_PATH' is not defined
------------------

[31m---------------------------------------------------------------------------[39m
[31mNameError[39m                                 Traceback (most recent call last)
[36mCell[39m[36m [39m[32mIn[2][39m[32m, line 15[39m
[32m     12[39m         [38;5;28mprint[39m([33m"[39m[33mAviso: no se pudo cargar bootstrap_df automÃ¡ticamente:[39m[33m"[39m, e)
[32m     14[39m [38;5;66;03m# 1) OLS (base)[39;00m
[32m---> [39m[32m15[39m coef_ols = [43mmodelo_base[49m.params                    [38;5;66;03m# pd.Series con Ã­ndice = nombres de coeficientes[39;00m
[32m     16[39m se_ols   = modelo_base.bse                       [38;5;66;03m# pd.Series[39;00m
[32m     17[39m ci_ols   = modelo_base.conf_int()                [38;5;66;03m# pd.DataFrame [lower, upper][39;00m

[31mNameError[39m: name 'modelo_base' is not defined

